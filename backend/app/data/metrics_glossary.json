{
  "version": "1.5",
  "updatedAt": "2026-01-22",
  "source": "backend/app/services/calculators.py, backend/app/services/data_normalizer.py, frontend/src/lib/iqTarget.ts, backend/app/main.py",
  "market_statistics": {
    "description": "Market health indicators from RentCast saleData for buyer/seller market analysis",
    "source": "RentCast Markets API",
    "metrics": {
      "median_days_on_market": {
        "formula": "median_days_on_market = saleData.medianDaysOnMarket",
        "inputs": ["saleData.medianDaysOnMarket"],
        "description": "The median number of days properties stay on market before selling. Key indicator of market velocity."
      },
      "avg_days_on_market": {
        "formula": "avg_days_on_market = saleData.averageDaysOnMarket",
        "inputs": ["saleData.averageDaysOnMarket"],
        "description": "The average number of days properties stay on market. May be skewed by outliers."
      },
      "min_days_on_market": {
        "formula": "min_days_on_market = saleData.minDaysOnMarket",
        "inputs": ["saleData.minDaysOnMarket"],
        "description": "The fastest sale in the market. Indicates demand for well-priced properties."
      },
      "max_days_on_market": {
        "formula": "max_days_on_market = saleData.maxDaysOnMarket",
        "inputs": ["saleData.maxDaysOnMarket"],
        "description": "The longest time on market. Properties priced too high or with issues."
      },
      "total_listings": {
        "formula": "total_listings = saleData.totalListings",
        "inputs": ["saleData.totalListings"],
        "description": "Total active inventory in the market area."
      },
      "new_listings": {
        "formula": "new_listings = saleData.newListings",
        "inputs": ["saleData.newListings"],
        "description": "Number of new listings added in the most recent period."
      },
      "absorption_rate": {
        "formula": "absorption_rate = new_listings / total_listings",
        "inputs": ["new_listings", "total_listings"],
        "description": "Rate at which new inventory enters the market relative to total inventory. Higher rate indicates faster-moving market (seller's market). Lower rate indicates slower market with aging inventory (buyer's market).",
        "interpretation": "0.10+ = Fast absorption (seller's market), 0.05-0.10 = Normal, <0.05 = Slow absorption (buyer's market)"
      },
      "market_temperature": {
        "formula": "if median_days_on_market < 30: 'hot' (seller's market); elif median_days_on_market <= 60: 'warm' (balanced); else: 'cold' (buyer's market)",
        "inputs": ["median_days_on_market"],
        "description": "Classification of market conditions based on days on market.",
        "interpretation": {
          "hot": "Seller's market - Properties sell quickly. Limited negotiation room. Expected discount: 0-3%.",
          "warm": "Balanced market - Normal conditions. Moderate negotiation possible. Expected discount: 3-7%.",
          "cold": "Buyer's market - High inventory, properties sit longer. Strong negotiation leverage. Expected discount: 7-15%."
        }
      },
      "median_price": {
        "formula": "median_price = saleData.medianPrice",
        "inputs": ["saleData.medianPrice"],
        "description": "Median sale price in the market area."
      },
      "avg_price_per_sqft": {
        "formula": "avg_price_per_sqft = saleData.averagePricePerSquareFoot",
        "inputs": ["saleData.averagePricePerSquareFoot"],
        "description": "Average price per square foot in the market area. Useful for quick valuation comparisons."
      }
    }
  },
  "rental_market_statistics": {
    "description": "Rental market statistics from RentCast rentalData and Zillow for rental investment analysis",
    "source": "RentCast Markets API (rentalData), Zillow Property API (rentZestimate), Zillow Market API (medianRentPriceOverTime)",
    "metrics": {
      "rental_rentcast_estimate": {
        "formula": "rental_rentcast_estimate = rent.rent",
        "inputs": ["RentCast rent estimate"],
        "description": "RentCast's property-specific rent estimate based on comparable rentals."
      },
      "rental_zillow_estimate": {
        "formula": "rental_zillow_estimate = property.rentZestimate",
        "inputs": ["Zillow rentZestimate"],
        "description": "Zillow's estimated monthly rent (rentZestimate) for the property."
      },
      "iq_estimate": {
        "formula": "iq_estimate = (rental_rentcast_estimate + rental_zillow_estimate) / 2; if only one source available, uses that value",
        "inputs": ["rental_rentcast_estimate", "rental_zillow_estimate"],
        "description": "InvestIQ proprietary rent estimate. Averages RentCast and Zillow estimates when both are available to provide a more balanced estimate. When only one source is available, uses that value with reduced confidence.",
        "notes": "This is a unique InvestIQ metric that combines the best data from both sources."
      },
      "market_avg_rent": {
        "formula": "market_avg_rent = rentalData.averageRent",
        "inputs": ["rentalData.averageRent"],
        "description": "Average rent in the market area across all rental listings."
      },
      "market_median_rent": {
        "formula": "market_median_rent = rentalData.medianRent",
        "inputs": ["rentalData.medianRent"],
        "description": "Median rent in the market area. Less affected by outliers than average."
      },
      "market_min_rent": {
        "formula": "market_min_rent = rentalData.minRent",
        "inputs": ["rentalData.minRent"],
        "description": "Minimum rent in the market area. Represents floor of rental market."
      },
      "market_max_rent": {
        "formula": "market_max_rent = rentalData.maxRent",
        "inputs": ["rentalData.maxRent"],
        "description": "Maximum rent in the market area. Represents ceiling of rental market."
      },
      "market_rent_per_sqft": {
        "formula": "market_rent_per_sqft = rentalData.averageRentPerSquareFoot",
        "inputs": ["rentalData.averageRentPerSquareFoot"],
        "description": "Average rent per square foot in the market. Useful for comparing rental efficiency."
      },
      "rental_days_on_market": {
        "formula": "rental_days_on_market = rentalData.medianDaysOnMarket",
        "inputs": ["rentalData.medianDaysOnMarket"],
        "description": "Median number of days rental listings stay on market. Lower values indicate high rental demand."
      },
      "rental_total_listings": {
        "formula": "rental_total_listings = rentalData.totalListings",
        "inputs": ["rentalData.totalListings"],
        "description": "Total number of active rental listings in the market area."
      },
      "rental_new_listings": {
        "formula": "rental_new_listings = rentalData.newListings",
        "inputs": ["rentalData.newListings"],
        "description": "Number of new rental listings added in the most recent period."
      },
      "rent_trend": {
        "formula": "if pct_change > 0.02: 'up'; elif pct_change < -0.02: 'down'; else: 'stable'",
        "inputs": ["current_year_avg_rent", "prev_year_avg_rent"],
        "description": "Direction of rental market trend based on year-over-year comparison. Uses ±2% threshold to filter noise.",
        "interpretation": {
          "up": "Rents are rising - favorable for landlords, may support higher rent assumptions",
          "down": "Rents are falling - be conservative with rent projections",
          "stable": "Rents are flat - use current market rates for projections"
        }
      },
      "rent_trend_pct": {
        "formula": "rent_trend_pct = (current_year_avg - prev_year_avg) / prev_year_avg; where current_year_avg = avg(medianRentPriceOverTime.currentYear[*].price); prev_year_avg = avg(medianRentPriceOverTime.prevYear[*].price)",
        "inputs": ["medianRentPriceOverTime.currentYear", "medianRentPriceOverTime.prevYear"],
        "description": "Year-over-year percentage change in median rents. Positive values indicate rent growth, negative values indicate rent decline.",
        "source": "AXESSO Zillow Market Data API",
        "notes": "Calculated from Zillow's medianRentPriceOverTime which provides monthly rent data for current and previous year."
      }
    }
  },
  "deal_opportunity_score": {
    "description": "Deal Opportunity Score - Investment Price Indicator. A composite weighted score that considers multiple factors to determine how attractive a property is as an investment opportunity.",
    "source": "backend/app/services/calculators.py, frontend/src/lib/iqTarget.ts",
    "notes": [
      "Equity % is excluded as mortgage balance data is not available from the Axesso API (would require public records data).",
      "BRRRR, Fix & Flip, and Wholesale strategies require physical inspection for repair estimates.",
      "The Deal Score is based on LTR breakeven since it can be calculated from available market data."
    ],
    "metrics": {
      "deal_opportunity_score": {
        "formula": "deal_opportunity_score = (deal_gap_score × 0.50) + (availability_score × 0.30) + (dom_score × 0.20)",
        "inputs": ["deal_gap_score", "availability_score", "dom_score"],
        "description": "Composite weighted score (0-100) combining Deal Gap, Availability Ranking, and Days on Market factors.",
        "weights": {
          "deal_gap": 0.50,
          "availability": 0.30,
          "days_on_market": 0.20
        },
        "grading": {
          "A+": { "min_score": 85, "label": "Strong Opportunity", "color": "#22c55e" },
          "A": { "min_score": 70, "label": "Great Opportunity", "color": "#22c55e" },
          "B": { "min_score": 55, "label": "Moderate Opportunity", "color": "#84cc16" },
          "C": { "min_score": 40, "label": "Potential Opportunity", "color": "#f97316" },
          "D": { "min_score": 25, "label": "Weak Opportunity", "color": "#f97316" },
          "F": { "min_score": 0, "label": "Poor Opportunity", "color": "#ef4444" }
        }
      },
      "deal_gap": {
        "formula": "deal_gap_percent = ((list_price - breakeven_price) / list_price) × 100; deal_gap_score = max(0, min(100, 100 - (deal_gap_percent × 100 / 45)))",
        "inputs": ["list_price", "breakeven_price"],
        "description": "Primary factor (50% weight). Measures how much discount from list price is needed to reach breakeven. A positive gap means the list price is above breakeven (need discount). A negative gap means property is already profitable at list price.",
        "interpretation": {
          "0%_gap": "100 score - Property profitable at list price",
          "45%+_gap": "0 score - Significant discount needed"
        }
      },
      "ltr_breakeven_price": {
        "formula": "breakeven_price = NOI / (LTV × mortgage_constant); where NOI = effective_gross_income - operating_expenses; effective_gross_income = monthly_rent × 12 × (1 - vacancy_rate); operating_expenses = property_taxes + insurance + (effective_gross_income × maintenance_pct) + (effective_gross_income × management_pct); LTV = 1 - down_payment_pct; mortgage_constant = (monthly_rate × (1 + monthly_rate)^n) / ((1 + monthly_rate)^n - 1) × 12",
        "inputs": ["monthly_rent", "property_taxes", "insurance", "vacancy_rate", "maintenance_pct", "management_pct", "down_payment_pct", "interest_rate", "loan_term_years"],
        "description": "The purchase price at which monthly cash flow equals $0 (NOI = Annual Debt Service). Used as the basis for Deal Gap calculation.",
        "defaults": {
          "vacancy_rate": 0.01,
          "maintenance_pct": 0.05,
          "management_pct": 0.00,
          "down_payment_pct": 0.20,
          "interest_rate": 0.06,
          "loan_term_years": 30
        }
      },
      "availability_ranking": {
        "formula": "availability_score based on listing status rank (1-9, where 1 = best opportunity)",
        "inputs": ["listing_status", "seller_type", "is_foreclosure", "is_bank_owned", "is_fsbo", "is_auction", "price_reductions"],
        "description": "Seller motivation factor (30% weight). Ranks properties by likelihood of successful negotiation based on listing status and seller type.",
        "rankings": {
          "1_WITHDRAWN": { "score": 100, "label": "Withdrawn - High Motivation", "motivation": "high" },
          "2_PRICE_REDUCED": { "score": 90, "label": "Price Reduced 2+ Times", "motivation": "high" },
          "3_BANK_OWNED": { "score": 80, "label": "Bank Owned (REO) / Foreclosure", "motivation": "high" },
          "4_FSBO": { "score": 70, "label": "For Sale By Owner", "motivation": "medium" },
          "5_AGENT_LISTED": { "score": 60, "label": "For Sale - Agent Listed", "motivation": "medium" },
          "6_OFF_MARKET": { "score": 50, "label": "Off-Market", "motivation": "low" },
          "7_FOR_RENT": { "score": 40, "label": "For Rent", "motivation": "low" },
          "8_PENDING": { "score": 20, "label": "Pending - Under Contract", "motivation": "low" },
          "9_SOLD": { "score": 10, "label": "Recently Sold", "motivation": "low" }
        }
      },
      "dom_score": {
        "formula": "dom_score = f(days_on_market, deal_gap_percent); scoring varies based on DOM thresholds (30, 60, 120 days) and deal gap thresholds (10%, 25%)",
        "inputs": ["days_on_market", "deal_gap_percent"],
        "description": "Days on Market factor (20% weight). Score considers DOM in context of Deal Gap to assess negotiation leverage.",
        "interpretation": {
          "high_gap_high_dom": "100 score - Strong negotiation leverage (seller may be desperate)",
          "high_gap_low_dom": "60 score - Opportunity not yet recognized by market",
          "low_gap_high_dom": "50 score - Price may already be fair (not much room)",
          "low_gap_low_dom": "30 score - Hot property, move fast if interested"
        },
        "leverage_levels": {
          "high": "High Deal Gap (25%+) + High DOM (120+ days)",
          "medium": "Medium Deal Gap (10-25%) or Medium DOM (30-120 days)",
          "low": "Low Deal Gap (<10%) or Low DOM (<30 days)",
          "unknown": "DOM data not available"
        }
      }
    }
  },
  "strategies": [
    {
      "id": "ltr",
      "name": "Long-Term Rental",
      "metrics": {
        "monthly_rent": { "formula": "monthly_rent = input", "inputs": ["monthly_rent"] },
        "annual_gross_rent": { "formula": "annual_gross_rent = monthly_rent * 12", "inputs": ["monthly_rent"] },
        "vacancy_loss": { "formula": "vacancy_loss = annual_gross_rent * vacancy_rate", "inputs": ["annual_gross_rent", "vacancy_rate"] },
        "effective_gross_income": { "formula": "effective_gross_income = annual_gross_rent - vacancy_loss", "inputs": ["annual_gross_rent", "vacancy_loss"] },
        "property_taxes": { "formula": "property_taxes = property_taxes_annual", "inputs": ["property_taxes_annual"] },
        "insurance": { "formula": "insurance = insurance_annual", "inputs": ["insurance_annual"] },
        "property_management": { "formula": "property_management = annual_gross_rent * property_management_pct", "inputs": ["annual_gross_rent", "property_management_pct"] },
        "maintenance": { "formula": "maintenance = annual_gross_rent * maintenance_pct", "inputs": ["annual_gross_rent", "maintenance_pct"] },
        "utilities": { "formula": "utilities = utilities_monthly * 12", "inputs": ["utilities_monthly"] },
        "landscaping": { "formula": "landscaping = landscaping_annual", "inputs": ["landscaping_annual"] },
        "pest_control": { "formula": "pest_control = pest_control_annual", "inputs": ["pest_control_annual"] },
        "hoa_fees": { "formula": "hoa_fees = hoa_monthly * 12", "inputs": ["hoa_monthly"] },
        "total_operating_expenses": {
          "formula": "total_operating_expenses = property_taxes + insurance + property_management + maintenance + utilities + landscaping + pest_control + hoa_fees",
          "inputs": ["property_taxes", "insurance", "property_management", "maintenance", "utilities", "landscaping", "pest_control", "hoa_fees"]
        },
        "loan_amount": { "formula": "loan_amount = purchase_price - down_payment", "inputs": ["purchase_price", "down_payment"] },
        "monthly_pi": { "formula": "monthly_pi = mortgage_payment(loan_amount, interest_rate, loan_term_years)", "inputs": ["loan_amount", "interest_rate", "loan_term_years"] },
        "annual_debt_service": { "formula": "annual_debt_service = monthly_pi * 12", "inputs": ["monthly_pi"] },
        "noi": { "formula": "noi = effective_gross_income - total_operating_expenses", "inputs": ["effective_gross_income", "total_operating_expenses"] },
        "monthly_cash_flow": { "formula": "monthly_cash_flow = annual_cash_flow / 12", "inputs": ["annual_cash_flow"] },
        "annual_cash_flow": { "formula": "annual_cash_flow = noi - annual_debt_service", "inputs": ["noi", "annual_debt_service"] },
        "cap_rate": { "formula": "cap_rate = noi / purchase_price", "inputs": ["noi", "purchase_price"] },
        "cash_on_cash_return": { "formula": "cash_on_cash_return = annual_cash_flow / total_cash_required", "inputs": ["annual_cash_flow", "total_cash_required"] },
        "dscr": { "formula": "dscr = noi / annual_debt_service", "inputs": ["noi", "annual_debt_service"] },
        "grm": { "formula": "grm = purchase_price / annual_gross_rent", "inputs": ["purchase_price", "annual_gross_rent"] },
        "one_percent_rule": { "formula": "one_percent_rule = monthly_rent / purchase_price", "inputs": ["monthly_rent", "purchase_price"] },
        "total_cash_required": { "formula": "total_cash_required = down_payment + closing_costs", "inputs": ["down_payment", "closing_costs"] },
        "down_payment": { "formula": "down_payment = purchase_price * down_payment_pct", "inputs": ["purchase_price", "down_payment_pct"] },
        "closing_costs": { "formula": "closing_costs = purchase_price * closing_costs_pct", "inputs": ["purchase_price", "closing_costs_pct"] },
        "ten_year_projection": {
          "formula": "Per year: gross_rent = annual_gross_rent*(1+rent_growth_rate)^(year-1), expenses = total_operating_expenses*(1+expense_growth_rate)^(year-1), noi = gross_rent*(1-vacancy_rate)-expenses, cash_flow = noi - annual_debt_service, property_value = purchase_price*(1+appreciation_rate)^year, equity = property_value - (loan_amount*(1-(year/loan_term_years)*0.3))",
          "inputs": ["annual_gross_rent", "rent_growth_rate", "total_operating_expenses", "expense_growth_rate", "vacancy_rate", "annual_debt_service", "purchase_price", "appreciation_rate", "loan_amount", "loan_term_years"]
        },
        "breakeven_price": {
          "formula": "breakeven_price = NOI / (LTV * mortgage_constant); where NOI = effective_gross_income - operating_expenses; LTV = 1 - down_payment_pct; mortgage_constant = (monthly_rate * (1 + monthly_rate)^n) / ((1 + monthly_rate)^n - 1) * 12",
          "inputs": ["monthly_rent", "vacancy_rate", "property_taxes", "insurance", "maintenance_pct", "management_pct", "down_payment_pct", "interest_rate", "loan_term_years"],
          "description": "The purchase price at which monthly cash flow equals $0 (NOI = Annual Debt Service)"
        },
        "buy_discount_pct": {
          "formula": "buy_discount_pct = input (default 0.05)",
          "inputs": ["buy_discount_pct"],
          "description": "The discount percentage below breakeven to ensure profitability (default 5%)"
        },
        "buy_price": {
          "formula": "buy_price = breakeven_price * (1 - buy_discount_pct); capped at list_price",
          "inputs": ["breakeven_price", "buy_discount_pct", "list_price"],
          "description": "The recommended purchase price, calculated as breakeven minus the buy discount to ensure profitability"
        }
      }
    },
    {
      "id": "str",
      "name": "Short-Term Rental",
      "metrics": {
        "average_daily_rate": { "formula": "average_daily_rate = input", "inputs": ["average_daily_rate"] },
        "occupancy_rate": { "formula": "occupancy_rate = input", "inputs": ["occupancy_rate"] },
        "nights_occupied": { "formula": "nights_occupied = 365 * occupancy_rate", "inputs": ["occupancy_rate"] },
        "num_bookings": { "formula": "num_bookings = nights_occupied / avg_length_of_stay_days", "inputs": ["nights_occupied", "avg_length_of_stay_days"] },
        "rental_revenue": { "formula": "rental_revenue = average_daily_rate * nights_occupied", "inputs": ["average_daily_rate", "nights_occupied"] },
        "cleaning_fee_revenue": { "formula": "cleaning_fee_revenue = cleaning_fee_revenue * num_bookings", "inputs": ["cleaning_fee_revenue", "num_bookings"] },
        "total_gross_revenue": { "formula": "total_gross_revenue = rental_revenue + cleaning_fee_revenue", "inputs": ["rental_revenue", "cleaning_fee_revenue"] },
        "property_taxes": { "formula": "property_taxes = property_taxes_annual", "inputs": ["property_taxes_annual"] },
        "insurance": { "formula": "insurance = insurance_annual", "inputs": ["insurance_annual"] },
        "platform_fees": { "formula": "platform_fees = total_gross_revenue * platform_fees_pct", "inputs": ["total_gross_revenue", "platform_fees_pct"] },
        "str_management": { "formula": "str_management = total_gross_revenue * str_management_pct", "inputs": ["total_gross_revenue", "str_management_pct"] },
        "cleaning_costs": { "formula": "cleaning_costs = cleaning_cost_per_turnover * num_bookings", "inputs": ["cleaning_cost_per_turnover", "num_bookings"] },
        "supplies": { "formula": "supplies = supplies_monthly * 12", "inputs": ["supplies_monthly"] },
        "utilities": { "formula": "utilities = additional_utilities_monthly * 12", "inputs": ["additional_utilities_monthly"] },
        "maintenance": { "formula": "maintenance = maintenance_annual", "inputs": ["maintenance_annual"] },
        "landscaping": { "formula": "landscaping = landscaping_annual", "inputs": ["landscaping_annual"] },
        "pest_control": { "formula": "pest_control = pest_control_annual", "inputs": ["pest_control_annual"] },
        "total_operating_expenses": {
          "formula": "total_operating_expenses = taxes + insurance + platform_fees + str_management + cleaning_costs + supplies + utilities + maintenance + landscaping + pest_control + hoa_annual",
          "inputs": ["property_taxes", "insurance", "platform_fees", "str_management", "cleaning_costs", "supplies", "utilities", "maintenance", "landscaping", "pest_control", "hoa_monthly"]
        },
        "loan_amount": { "formula": "loan_amount = purchase_price - down_payment", "inputs": ["purchase_price", "down_payment"] },
        "monthly_pi": { "formula": "monthly_pi = mortgage_payment(loan_amount, interest_rate, loan_term_years)", "inputs": ["loan_amount", "interest_rate", "loan_term_years"] },
        "annual_debt_service": { "formula": "annual_debt_service = monthly_pi * 12", "inputs": ["monthly_pi"] },
        "noi": { "formula": "noi = total_gross_revenue - total_operating_expenses", "inputs": ["total_gross_revenue", "total_operating_expenses"] },
        "monthly_cash_flow": { "formula": "monthly_cash_flow = annual_cash_flow / 12", "inputs": ["annual_cash_flow"] },
        "annual_cash_flow": { "formula": "annual_cash_flow = noi - annual_debt_service", "inputs": ["noi", "annual_debt_service"] },
        "cap_rate": { "formula": "cap_rate = noi / purchase_price", "inputs": ["noi", "purchase_price"] },
        "cash_on_cash_return": { "formula": "cash_on_cash_return = annual_cash_flow / total_cash_required", "inputs": ["annual_cash_flow", "total_cash_required"] },
        "dscr": { "formula": "dscr = noi / annual_debt_service", "inputs": ["noi", "annual_debt_service"] },
        "revenue_per_available_night": { "formula": "revenue_per_available_night = total_gross_revenue / 365", "inputs": ["total_gross_revenue"] },
        "break_even_occupancy": {
          "formula": "break_even_occupancy = break_even_nights / 365; break_even_nights = fixed_costs / revenue_per_night_net; revenue_per_night_net = ADR - variable_cost_per_night",
          "inputs": ["property_taxes_annual", "insurance_annual", "maintenance_annual", "landscaping_annual", "pest_control_annual", "hoa_monthly", "annual_debt_service", "average_daily_rate", "platform_fees_pct", "str_management_pct", "cleaning_cost_per_turnover", "avg_length_of_stay_days"],
          "description": "The minimum occupancy rate needed to cover all fixed costs and debt service"
        },
        "breakeven_price": {
          "formula": "breakeven_price = NOI / (LTV * mortgage_constant); where NOI = total_gross_revenue - total_operating_expenses; uses same formula as LTR but with STR revenue assumptions",
          "inputs": ["average_daily_rate", "occupancy_rate", "total_operating_expenses", "down_payment_pct", "interest_rate", "loan_term_years"],
          "description": "The purchase price at which annual cash flow equals $0 at the given occupancy and ADR"
        },
        "buy_discount_pct": {
          "formula": "buy_discount_pct = input (default 0.05)",
          "inputs": ["buy_discount_pct"],
          "description": "The discount percentage below breakeven to ensure profitability (default 5%)"
        },
        "buy_price": {
          "formula": "buy_price = breakeven_price * (1 - buy_discount_pct); capped at list_price",
          "inputs": ["breakeven_price", "buy_discount_pct", "list_price"],
          "description": "The recommended purchase price, calculated as breakeven minus the buy discount to ensure profitability"
        },
        "total_cash_required": { "formula": "total_cash_required = down_payment + closing_costs + furniture_setup_cost", "inputs": ["down_payment", "closing_costs", "furniture_setup_cost"] },
        "down_payment": { "formula": "down_payment = purchase_price * down_payment_pct", "inputs": ["purchase_price", "down_payment_pct"] },
        "closing_costs": { "formula": "closing_costs = purchase_price * closing_costs_pct", "inputs": ["purchase_price", "closing_costs_pct"] },
        "furniture_setup": { "formula": "furniture_setup = furniture_setup_cost", "inputs": ["furniture_setup_cost"] },
        "seasonality_analysis": { "formula": "Hardcoded seasonal buckets using ADR and occupancy adjustments", "inputs": ["average_daily_rate"] }
      }
    },
    {
      "id": "brrrr",
      "name": "BRRRR",
      "metrics": {
        "purchase_price": { "formula": "purchase_price = market_value * (1 - purchase_discount_pct)", "inputs": ["market_value", "purchase_discount_pct"] },
        "down_payment": { "formula": "down_payment = purchase_price * down_payment_pct", "inputs": ["purchase_price", "down_payment_pct"] },
        "closing_costs": { "formula": "closing_costs = purchase_price * closing_costs_pct", "inputs": ["purchase_price", "closing_costs_pct"] },
        "initial_loan_amount": { "formula": "initial_loan_amount = purchase_price - down_payment", "inputs": ["purchase_price", "down_payment"] },
        "cash_required_phase1": { "formula": "cash_required_phase1 = down_payment + closing_costs", "inputs": ["down_payment", "closing_costs"] },
        "renovation_budget": { "formula": "renovation_budget = input", "inputs": ["renovation_budget"] },
        "contingency": { "formula": "contingency = renovation_budget * contingency_pct", "inputs": ["renovation_budget", "contingency_pct"] },
        "holding_costs": { "formula": "holding_costs = monthly_holding_costs * holding_period_months", "inputs": ["monthly_holding_costs", "holding_period_months"] },
        "cash_required_phase2": { "formula": "cash_required_phase2 = total_rehab + holding_costs; total_rehab = renovation_budget + contingency", "inputs": ["renovation_budget", "contingency", "holding_costs"] },
        "total_cash_invested": { "formula": "total_cash_invested = cash_required_phase1 + cash_required_phase2", "inputs": ["cash_required_phase1", "cash_required_phase2"] },
        "arv": { "formula": "arv = input", "inputs": ["arv"] },
        "post_rehab_monthly_rent": { "formula": "post_rehab_monthly_rent = monthly_rent_post_rehab", "inputs": ["monthly_rent_post_rehab"] },
        "annual_gross_rent": { "formula": "annual_gross_rent = monthly_rent_post_rehab * 12", "inputs": ["monthly_rent_post_rehab"] },
        "estimated_cap_rate": { "formula": "estimated_cap_rate = noi / arv", "inputs": ["noi", "arv"] },
        "refinance_loan_amount": { "formula": "refinance_loan_amount = arv * refinance_ltv", "inputs": ["arv", "refinance_ltv"] },
        "refinance_costs": { "formula": "refinance_costs = refinance_closing_costs", "inputs": ["refinance_closing_costs"] },
        "original_loan_payoff": { "formula": "original_loan_payoff = initial_loan_amount", "inputs": ["initial_loan_amount"] },
        "cash_out_at_refinance": { "formula": "cash_out_at_refinance = refinance_loan_amount - initial_loan_amount - refinance_closing_costs", "inputs": ["refinance_loan_amount", "initial_loan_amount", "refinance_closing_costs"] },
        "new_monthly_pi": { "formula": "new_monthly_pi = mortgage_payment(refinance_loan_amount, refinance_interest_rate, refinance_term_years)", "inputs": ["refinance_loan_amount", "refinance_interest_rate", "refinance_term_years"] },
        "total_cash_invested": { "formula": "total_cash_invested = cash_required_phase1 + cash_required_phase2", "inputs": ["cash_required_phase1", "cash_required_phase2"] },
        "capital_recycled_pct": { "formula": "capital_recycled_pct = cash_out_at_refinance / total_cash_invested", "inputs": ["cash_out_at_refinance", "total_cash_invested"] },
        "cash_left_in_deal": { "formula": "cash_left_in_deal = total_cash_invested - cash_out_at_refinance", "inputs": ["total_cash_invested", "cash_out_at_refinance"] },
        "equity_position": { "formula": "equity_position = arv - refinance_loan_amount", "inputs": ["arv", "refinance_loan_amount"] },
        "equity_pct": { "formula": "equity_pct = equity_position / arv", "inputs": ["equity_position", "arv"] },
        "post_refi_annual_cash_flow": { "formula": "post_refi_annual_cash_flow = noi - new_annual_debt_service", "inputs": ["noi", "new_annual_debt_service"] },
        "post_refi_monthly_cash_flow": { "formula": "post_refi_monthly_cash_flow = post_refi_annual_cash_flow / 12", "inputs": ["post_refi_annual_cash_flow"] },
        "post_refi_cash_on_cash": { "formula": "post_refi_cash_on_cash = post_refi_annual_cash_flow / cash_left_in_deal", "inputs": ["post_refi_annual_cash_flow", "cash_left_in_deal"] },
        "infinite_roi_achieved": { "formula": "infinite_roi_achieved = cash_left_in_deal <= 0", "inputs": ["cash_left_in_deal"] },
        "total_months_to_repeat": { "formula": "total_months_to_repeat = holding_period_months + 2 + 1", "inputs": ["holding_period_months"] },
        "operating_expenses_note": {
          "formula": "operating_expenses = (annual_gross_rent * operating_expense_pct) + property_taxes_annual + insurance_annual",
          "inputs": ["annual_gross_rent", "operating_expense_pct", "property_taxes_annual", "insurance_annual"],
          "notes": "insurance_annual is referenced in code but not defined in function signature"
        },
        "breakeven_price": {
          "formula": "breakeven_price = NOI / (LTV * mortgage_constant); uses post-rehab rent and refinance terms; where NOI = (post_rehab_monthly_rent * 12 * (1 - vacancy_rate)) - operating_expenses",
          "inputs": ["post_rehab_monthly_rent", "vacancy_rate", "operating_expense_pct", "property_taxes_annual", "insurance_annual", "refinance_ltv", "refinance_interest_rate", "refinance_term_years"],
          "description": "The purchase price at which post-refinance monthly cash flow equals $0"
        },
        "buy_discount_pct": {
          "formula": "buy_discount_pct = input (default 0.05)",
          "inputs": ["buy_discount_pct"],
          "description": "The discount percentage below breakeven to ensure profitability (default 5%)"
        },
        "buy_price": {
          "formula": "buy_price = breakeven_price * (1 - buy_discount_pct); capped at list_price",
          "inputs": ["breakeven_price", "buy_discount_pct", "list_price"],
          "description": "The recommended purchase price, calculated as breakeven minus the buy discount to ensure profitability"
        }
      }
    },
    {
      "id": "flip",
      "name": "Fix & Flip",
      "metrics": {
        "purchase_price": { "formula": "purchase_price = market_value * (1 - purchase_discount_pct)", "inputs": ["market_value", "purchase_discount_pct"] },
        "hard_money_loan": { "formula": "hard_money_loan = purchase_price * hard_money_ltv", "inputs": ["purchase_price", "hard_money_ltv"] },
        "down_payment": { "formula": "down_payment = purchase_price - hard_money_loan", "inputs": ["purchase_price", "hard_money_loan"] },
        "closing_costs": { "formula": "closing_costs = purchase_price * closing_costs_pct", "inputs": ["purchase_price", "closing_costs_pct"] },
        "inspection_costs": { "formula": "inspection_costs = inspection_costs", "inputs": ["inspection_costs"] },
        "total_acquisition_cash": { "formula": "total_acquisition_cash = down_payment + closing_costs + inspection_costs", "inputs": ["down_payment", "closing_costs", "inspection_costs"] },
        "renovation_budget": { "formula": "renovation_budget = renovation_budget", "inputs": ["renovation_budget"] },
        "contingency": { "formula": "contingency = renovation_budget * contingency_pct", "inputs": ["renovation_budget", "contingency_pct"] },
        "total_renovation": { "formula": "total_renovation = renovation_budget + contingency", "inputs": ["renovation_budget", "contingency"] },
        "hard_money_interest": { "formula": "hard_money_interest = hard_money_loan * hard_money_rate * (holding_period_months / 12)", "inputs": ["hard_money_loan", "hard_money_rate", "holding_period_months"] },
        "property_taxes": { "formula": "property_taxes = property_taxes_annual * (holding_period_months / 12)", "inputs": ["property_taxes_annual", "holding_period_months"] },
        "insurance": { "formula": "insurance = insurance_annual * (holding_period_months / 12)", "inputs": ["insurance_annual", "holding_period_months"] },
        "utilities": { "formula": "utilities = utilities_monthly * holding_period_months", "inputs": ["utilities_monthly", "holding_period_months"] },
        "security_maintenance": { "formula": "security_maintenance = security_maintenance_monthly * holding_period_months", "inputs": ["security_maintenance_monthly", "holding_period_months"] },
        "total_holding_costs": {
          "formula": "total_holding_costs = hard_money_interest + property_taxes + insurance + utilities + security_maintenance",
          "inputs": ["hard_money_interest", "property_taxes", "insurance", "utilities", "security_maintenance"]
        },
        "total_project_cost": {
          "formula": "total_project_cost = purchase_price + closing_costs + inspection_costs + total_renovation + total_holding_costs",
          "inputs": ["purchase_price", "closing_costs", "inspection_costs", "total_renovation", "total_holding_costs"]
        },
        "total_cash_required": {
          "formula": "total_cash_required = total_acquisition_cash + total_renovation + total_holding_costs",
          "inputs": ["total_acquisition_cash", "total_renovation", "total_holding_costs"]
        },
        "arv": { "formula": "arv = input", "inputs": ["arv"] },
        "realtor_commission": { "formula": "realtor_commission = arv * 0.06", "inputs": ["arv"] },
        "seller_closing_costs": { "formula": "seller_closing_costs = arv * 0.02", "inputs": ["arv"] },
        "total_selling_costs": { "formula": "total_selling_costs = arv * selling_costs_pct", "inputs": ["arv", "selling_costs_pct"] },
        "net_sale_proceeds": { "formula": "net_sale_proceeds = arv - total_selling_costs", "inputs": ["arv", "total_selling_costs"] },
        "gross_profit": { "formula": "gross_profit = arv - total_project_cost", "inputs": ["arv", "total_project_cost"] },
        "net_profit_before_tax": { "formula": "net_profit_before_tax = net_sale_proceeds - hard_money_loan - total_cash_required", "inputs": ["net_sale_proceeds", "hard_money_loan", "total_cash_required"] },
        "capital_gains_tax": { "formula": "capital_gains_tax = max(0, net_profit_before_tax * capital_gains_rate)", "inputs": ["net_profit_before_tax", "capital_gains_rate"] },
        "net_profit_after_tax": { "formula": "net_profit_after_tax = net_profit_before_tax - capital_gains_tax", "inputs": ["net_profit_before_tax", "capital_gains_tax"] },
        "roi": { "formula": "roi = net_profit_before_tax / total_cash_required", "inputs": ["net_profit_before_tax", "total_cash_required"] },
        "annualized_roi": { "formula": "annualized_roi = roi * (12 / holding_period_months)", "inputs": ["roi", "holding_period_months"] },
        "profit_margin": { "formula": "profit_margin = net_profit_before_tax / arv", "inputs": ["net_profit_before_tax", "arv"] },
        "seventy_pct_max_price": { "formula": "seventy_pct_max_price = (arv * 0.70) - renovation_budget", "inputs": ["arv", "renovation_budget"] },
        "meets_70_rule": { "formula": "meets_70_rule = purchase_price <= seventy_pct_max_price", "inputs": ["purchase_price", "seventy_pct_max_price"] },
        "minimum_sale_for_breakeven": {
          "formula": "minimum_sale_for_breakeven = total_project_cost / (1 - selling_costs_pct)",
          "inputs": ["total_project_cost", "selling_costs_pct"],
          "description": "The minimum sale price needed to recover all project costs after paying selling costs (typically 8%)"
        }
      }
    },
    {
      "id": "house_hack",
      "name": "House Hack",
      "metrics": {
        "purchase_price": { "formula": "purchase_price = input", "inputs": ["purchase_price"] },
        "down_payment": { "formula": "down_payment = purchase_price * down_payment_pct", "inputs": ["purchase_price", "down_payment_pct"] },
        "closing_costs": { "formula": "closing_costs = purchase_price * closing_costs_pct", "inputs": ["purchase_price", "closing_costs_pct"] },
        "loan_amount": { "formula": "loan_amount = purchase_price - down_payment", "inputs": ["purchase_price", "down_payment"] },
        "total_cash_required": { "formula": "total_cash_required = down_payment + closing_costs", "inputs": ["down_payment", "closing_costs"] },
        "monthly_pi": { "formula": "monthly_pi = mortgage_payment(loan_amount, interest_rate, loan_term_years)", "inputs": ["loan_amount", "interest_rate", "loan_term_years"] },
        "monthly_mip": { "formula": "monthly_mip = (loan_amount * fha_mip_rate) / 12", "inputs": ["loan_amount", "fha_mip_rate"] },
        "monthly_piti": { "formula": "monthly_piti = monthly_pi + monthly_mip + monthly_taxes + monthly_insurance", "inputs": ["monthly_pi", "monthly_mip", "monthly_taxes", "monthly_insurance"] },
        "rooms_rented": { "formula": "rooms_rented = input", "inputs": ["rooms_rented"] },
        "room_rent": { "formula": "room_rent = monthly_rent_per_room", "inputs": ["monthly_rent_per_room"] },
        "total_monthly_income": { "formula": "total_monthly_income = monthly_rent_per_room * rooms_rented", "inputs": ["monthly_rent_per_room", "rooms_rented"] },
        "utilities_shared": { "formula": "utilities_shared = utilities_shared_monthly", "inputs": ["utilities_shared_monthly"] },
        "maintenance": { "formula": "maintenance = maintenance_monthly", "inputs": ["maintenance_monthly"] },
        "total_monthly_expenses": {
          "formula": "total_monthly_expenses = monthly_piti + utilities_shared_monthly + maintenance_monthly",
          "inputs": ["monthly_piti", "utilities_shared_monthly", "maintenance_monthly"]
        },
        "net_housing_cost_scenario_a": { "formula": "net_housing_cost_scenario_a = total_monthly_expenses - total_monthly_income", "inputs": ["total_monthly_expenses", "total_monthly_income"] },
        "savings_vs_renting_a": { "formula": "savings_vs_renting_a = owner_unit_market_rent - net_housing_cost_scenario_a", "inputs": ["owner_unit_market_rent", "net_housing_cost_scenario_a"] },
        "annual_savings_a": { "formula": "annual_savings_a = savings_vs_renting_a * 12", "inputs": ["savings_vs_renting_a"] },
        "conversion_cost": { "formula": "conversion_cost = input", "inputs": ["conversion_cost"] },
        "unit2_rent": { "formula": "unit2_rent = input", "inputs": ["unit2_rent"] },
        "heloc_payment": { "formula": "heloc_payment = mortgage_payment(conversion_cost, 0.08, 10)", "inputs": ["conversion_cost"] },
        "net_housing_cost_scenario_b": {
          "formula": "net_housing_cost_scenario_b = (monthly_piti + heloc_payment + utilities_shared_monthly + maintenance_monthly*1.25) - unit2_rent",
          "inputs": ["monthly_piti", "heloc_payment", "utilities_shared_monthly", "maintenance_monthly", "unit2_rent"]
        },
        "savings_vs_renting_b": { "formula": "savings_vs_renting_b = owner_unit_market_rent - net_housing_cost_scenario_b", "inputs": ["owner_unit_market_rent", "net_housing_cost_scenario_b"] },
        "housing_cost_offset_pct": { "formula": "housing_cost_offset_pct = total_monthly_income / total_monthly_expenses", "inputs": ["total_monthly_income", "total_monthly_expenses"] },
        "live_free_threshold": { "formula": "live_free_threshold = total_monthly_expenses", "inputs": ["total_monthly_expenses"] },
        "roi_on_savings": { "formula": "roi_on_savings = annual_savings_a / total_cash_required", "inputs": ["annual_savings_a", "total_cash_required"] },
        "breakeven_effective_housing_cost": {
          "formula": "breakeven achieved when effective_housing_cost <= 0; effective_housing_cost = total_monthly_expenses - total_monthly_income; alternatively: breakeven when housing_cost_offset_pct >= 100%",
          "inputs": ["total_monthly_expenses", "total_monthly_income", "monthly_piti", "monthly_mip", "utilities_shared", "maintenance"],
          "description": "Breakeven occurs when rental income from tenants covers 100% of your housing costs (you live for free)"
        },
        "buy_discount_pct": {
          "formula": "buy_discount_pct = input (default 0.05)",
          "inputs": ["buy_discount_pct"],
          "description": "The discount percentage below breakeven to ensure profitability (default 5%)"
        },
        "buy_price": {
          "formula": "buy_price = breakeven_price * (1 - buy_discount_pct); capped at list_price",
          "inputs": ["breakeven_price", "buy_discount_pct", "list_price"],
          "description": "The recommended purchase price, calculated as breakeven minus the buy discount to ensure profitability"
        }
      }
    },
    {
      "id": "wholesale",
      "name": "Wholesale",
      "metrics": {
        "contract_price": { "formula": "contract_price = seventy_pct_max_offer", "inputs": ["seventy_pct_max_offer"] },
        "earnest_money": { "formula": "earnest_money = earnest_money_deposit", "inputs": ["earnest_money_deposit"] },
        "assignment_fee": { "formula": "assignment_fee = assignment_fee", "inputs": ["assignment_fee"] },
        "end_buyer_price": { "formula": "end_buyer_price = contract_price + assignment_fee", "inputs": ["contract_price", "assignment_fee"] },
        "marketing_costs": { "formula": "marketing_costs = marketing_costs", "inputs": ["marketing_costs"] },
        "total_cash_at_risk": { "formula": "total_cash_at_risk = earnest_money_deposit + marketing_costs", "inputs": ["earnest_money_deposit", "marketing_costs"] },
        "gross_profit": { "formula": "gross_profit = assignment_fee", "inputs": ["assignment_fee"] },
        "net_profit": { "formula": "net_profit = assignment_fee - marketing_costs", "inputs": ["assignment_fee", "marketing_costs"] },
        "roi": { "formula": "roi = net_profit / total_cash_at_risk", "inputs": ["net_profit", "total_cash_at_risk"] },
        "annualized_roi": { "formula": "annualized_roi = roi * (365 / days_to_close)", "inputs": ["roi", "days_to_close"] },
        "effective_hourly_rate": { "formula": "effective_hourly_rate = net_profit / time_investment_hours", "inputs": ["net_profit", "time_investment_hours"] },
        "time_investment_hours": { "formula": "time_investment_hours = input", "inputs": ["time_investment_hours"] },
        "arv": { "formula": "arv = input", "inputs": ["arv"] },
        "estimated_rehab": { "formula": "estimated_rehab = estimated_rehab_costs", "inputs": ["estimated_rehab_costs"] },
        "seventy_pct_max_offer": { "formula": "seventy_pct_max_offer = (arv * (1 - arv_discount_pct)) - estimated_rehab_costs", "inputs": ["arv", "arv_discount_pct", "estimated_rehab_costs"] },
        "spread_available": { "formula": "spread_available = arv - contract_price - estimated_rehab_costs", "inputs": ["arv", "contract_price", "estimated_rehab_costs"] },
        "deal_viability": {
          "formula": "If spread >= assignment_fee + 20000 → Strong; >= +10000 → Moderate; >= assignment_fee → Tight; else Not Viable",
          "inputs": ["spread_available", "assignment_fee"]
        },
        "deals_needed_50k": { "formula": "deals_needed_50k = 50000 / net_profit", "inputs": ["net_profit"] },
        "deals_needed_100k": { "formula": "deals_needed_100k = 100000 / net_profit", "inputs": ["net_profit"] },
        "timeline_days": { "formula": "timeline_days = days_to_close", "inputs": ["days_to_close"] },
        "breakeven_assignment_fee": {
          "formula": "breakeven_assignment_fee = marketing_costs + closing_costs; net_profit = 0 when assignment_fee = marketing_costs + closing_costs",
          "inputs": ["marketing_costs", "closing_costs"],
          "description": "The minimum assignment fee needed to cover marketing and closing costs with $0 profit"
        }
      }
    }
  ]
}
