# Nixpacks configuration for Railway deployment
#
# WeasyPrint requires system shared libraries (GLib/Cairo/Pango/etc.)
# loadable via cffi.dlopen() / ctypes.util.find_library().
#
# We use aptPkgs (not nixLibs) because apt packages install to standard
# system paths and register with ldconfig â€” which is what Python's
# ctypes.util.find_library() and cffi's ffi.dlopen() need at runtime.

[phases.setup]
aptPkgs = [
  "libglib2.0-dev",        # libgobject-2.0, libglib-2.0
  "libcairo2-dev",         # libcairo
  "libpango1.0-dev",       # libpango-1.0, libpangocairo-1.0, libpangoft2-1.0
  "libgdk-pixbuf-2.0-dev", # libgdk_pixbuf-2.0
  "libharfbuzz-dev",       # libharfbuzz
  "libfontconfig1-dev",    # libfontconfig
  "libfreetype6-dev",      # libfreetype
  "libffi-dev",            # libffi
  "shared-mime-info",      # MIME type database
  "fonts-liberation",      # Liberation font family (print-quality)
]

# Nixpacks' Python provider may generate `python -m venv` but the Nix
# python package only exposes `python3`.  Override the install phase to
# use `python3` explicitly.
[phases.install]
cmds = [
  "python3 -m venv --copies /opt/venv",
  ". /opt/venv/bin/activate && pip install --upgrade pip && pip install -r requirements.txt",
]
